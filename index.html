<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Priddle - Guess the Identity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-main: #f3f4f6;
            --text-main: #1f2937;
            --card-bg: #ffffff;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-main: #111827;
                --text-main: #f3f4f6;
                --card-bg: #1f2937;
            }
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-container {
            width: 100%;
            max-width: 600px;
            padding: 2rem;
            text-align: center;
        }

        .flag-display {
            aspect-ratio: 5 / 3;
            width: 100%;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin-bottom: 2rem;
            background-color: #ddd;
            position: relative;
            transition: all 0.5s ease;
        }

        .stripe-mask {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .mask-segment {
            flex: 1;
            background-color: #2b2b2b;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .mask-segment.revealed {
            opacity: 0;
            pointer-events: none;
        }

        .guess-history {
            margin-top: 1.5rem;
            text-align: left;
            width: 100%;
        }

        .history-item {
            padding: 0.5rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
        }

        input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
    </style>
</head>
<body class="p-4">

    <header class="mb-8 text-center mt-8">
        <h1 class="text-4xl font-extrabold mb-2 tracking-tight">Priddle</h1>
        <p class="opacity-75">Guess the flag! New stripes reveal with every wrong guess.</p>
        <p class="opacity-75">Developed by W. Hodder and O. Young</p>
    </header>

    <div class="game-container bg-[var(--card-bg)] rounded-3xl shadow-xl p-6 md:p-8">
        
        <div id="flag-display" class="flag-display">
            <div id="mask" class="stripe-mask"></div>
        </div>

        <!-- Gameplay Controls -->
        <div id="game-controls" class="flex flex-col gap-4">
            <div class="flex gap-2">
                <div class="relative flex-grow">
                    <input 
                        list="flag-list" 
                        id="guess-input" 
                        placeholder="Type a flag name..." 
                        class="w-full p-3 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-lg"
                    >
                    <datalist id="flag-list"></datalist>
                </div>
                <button 
                    onclick="submitGuess()" 
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-bold transition-colors"
                >
                    Submit
                </button>
            </div>
            <p id="message" class="font-semibold text-lg h-6"></p>
        </div>

        <!-- Success Screen -->
        <div id="success-controls" class="hidden flex flex-col gap-4">
            <h2 class="text-2xl font-bold text-green-500">Correct!</h2>
            <p id="win-text" class="text-lg opacity-90 mb-2"></p>
            <button 
                onclick="initGame()" 
                class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl font-bold text-xl transition-transform active:scale-95"
            >
                Play Again
            </button>
        </div>

        <!-- Failure Screen -->
        <div id="failure-controls" class="hidden flex flex-col gap-4">
            <h2 class="text-2xl font-bold text-red-500">Out of Guesses!</h2>
            <p id="fail-text" class="text-lg opacity-90 mb-2"></p>
            <button 
                onclick="initGame()" 
                class="bg-red-600 hover:bg-red-700 text-white px-8 py-4 rounded-xl font-bold text-xl transition-transform active:scale-95"
            >
                Try Again
            </button>
        </div>

        <div class="guess-history">
            <h3 class="text-sm font-bold uppercase opacity-50 mb-2">Guess History</h3>
            <div id="history-list"></div>
        </div>
    </div>

    <script>
        const flags = [
            { name: "Rainbow", colors: ["#E40303", "#FF8C00", "#FFED00", "#008026", "#24408E", "#732982"] },
            { name: "Aroace", colors: ["#E28C00", "#ECEC00", "#FFFFFF", "#62B0D9", "#203856"] },
            { name: "Transgender", colors: ["#5BCEFA", "#F5A9B8", "#FFFFFF", "#F5A9B8", "#5BCEFA"] },
            { name: "Bisexual", colors: ["#D60270", "#D60270", "#9B4F96", "#0038A8", "#0038A8"] },
            { name: "Pansexual", colors: ["#FF218C", "#FFD800", "#21B1FF"] },
            { name: "Asexual", colors: ["#000000", "#A3A3A3", "#FFFFFF", "#800080"] },
            { name: "Lesbian", colors: ["#D52D00", "#EF7627", "#FF9A56", "#FFFFFF", "#D162A4", "#B55690", "#A30262"] },
            { name: "Lipstick Lesbian", colors: ["#A60061", "#B95393", "#D260A1", "#FFFFFF", "#E5ABD0", "#C14D85", "#8C1D44"] },
            { name: "Butch Lesbian", colors: ["#D06301", "#E98D3F", "#FFB67F", "#FFFFFF", "#BDCFE5", "#88A6D0", "#547EB3"] },
            { name: "Vincian (Gay Man)", colors: ["#078970", "#26CEAA", "#98E8C1", "#FFFFFF", "#7BADE2", "#5049CC", "#3D1A78"] },
            { name: "Non-binary", colors: ["#FCF434", "#FFFFFF", "#9C59D1", "#2C2C2C"] },
            { name: "Genderqueer", colors: ["#B57EDC", "#FFFFFF", "#4A8123"] },
            { name: "Genderfluid", colors: ["#FF75A2", "#FFFFFF", "#BE18D6", "#000000", "#333EBD"] },
            { name: "Agender", colors: ["#000000", "#B9B9B9", "#FFFFFF", "#B8F483", "#FFFFFF", "#B9B9B9", "#000000"] },
            { name: "Aromantic", colors: ["#3BA434", "#A7D379", "#FFFFFF", "#A9A9A9", "#000000"] },
            { name: "Polysexual", colors: ["#F714BA", "#01D66A", "#1594F6"] },
            { name: "Omnisexual", colors: ["#FE9ACC", "#FF5291", "#141020", "#6760FE", "#8EA6FF"] },
            { name: "Abrosexual", colors: ["#76EFA7", "#B2F8D1", "#FFFFFF", "#F9A7B3", "#F2637D"] },
            { name: "Graysexual", colors: ["#800080", "#A3A3A3", "#FFFFFF", "#A3A3A3", "#800080"] },
            { name: "Grayromantic", colors: ["#3BA434", "#A9A9A9", "#FFFFFF", "#A9A9A9", "#3BA434"] },
            { name: "Litho / Akoi / Lithromantic", colors: ["#FA4B00", "#FFB600", "#FFFF00", "#FFFFFF", "#000000"] },
            { name: "Cupiosexual", colors: ["#808080", "#C0C0C0", "#FFFFFF", "#FF69B4"] },
            { name: "Reciprosexual", colors: ["#F6A8FF", "#FFFFFF", "#B6B6B6", "#424242"] },
            { name: "Fraysexual", colors: ["#424242", "#B6B6B6", "#FFFFFF", "#60A9FF"] },
            { name: "Apothisexual", colors: ["#000000", "#FFFFFF", "#800080", "#FFFFFF", "#000000"] },
            { name: "Aceflux", colors: ["#FF0000", "#FF7F00", "#FFFF00", "#00FF00", "#0000FF", "#4B0082", "#8F00FF"] },
            { name: "Queer", colors: ["#B57EDC", "#FFFFFF", "#4A8123", "#000000"] },
            { name: "Genderflux", colors: ["#FF75A2", "#FFB6C1", "#FFFFFF", "#D3D3D3", "#333EBD"] },
            { name: "Bigender", colors: ["#C479A2", "#D6A3C1", "#EDC4E5", "#FFFFFF", "#EDC4E5", "#AAB9E1", "#7A92CF"] },
            { name: "Trigender", colors: ["#FF75A2", "#BE18D6", "#333EBD", "#BE18D6", "#FF75A2"] },
            { name: "Pangender", colors: ["#FFF798", "#FFD398", "#FFB198", "#FFFFFF", "#FFB198", "#FFD398", "#FFF798"] },
            { name: "Neutrois", colors: ["#FFFFFF", "#00FF00", "#000000"] },
            { name: "Androgyne", colors: ["#E40303", "#732982", "#24408E"] },
            { name: "Demiboy", colors: ["#7F7F7F", "#C4C4C4", "#9AD9EB", "#FFFFFF", "#9AD9EB", "#C4C4C4", "#7F7F7F"] },
            { name: "Demigirl", colors: ["#7F7F7F", "#C4C4C4", "#FFAFC8", "#FFFFFF", "#FFAFC8", "#C4C4C4", "#7F7F7F"] },
            { name: "Demienby", colors: ["#7F7F7F", "#C4C4C4", "#FFFF00", "#FFFFFF", "#FFFF00", "#C4C4C4", "#7F7F7F"] },
            { name: "Transmasculine", colors: ["#FF8ABD", "#FFB6C1", "#FFFFFF", "#9AD9EB", "#5BCEFA", "#9AD9EB", "#FFFFFF"] },
            { name: "Transfeminine", colors: ["#5BCEFA", "#9AD9EB", "#FFFFFF", "#FFB6C1", "#FF8ABD", "#FFB6C1", "#FFFFFF"] },
            { name: "Gender Apathetic", colors: ["#A3A3A3", "#D3D3D3", "#FFFFFF", "#D3D3D3", "#A3A3A3"] },
            { name: "Maverique", colors: ["#F07400", "#FFFFFF", "#FCEC0C"] },
            { name: "Aliengender", colors: ["#000000", "#4B0082", "#32CD32", "#4B0082", "#000000"] },
            { name: "Xenogender", colors: ["#FDF332", "#FFFFFF", "#B079D1", "#000000"] },
            { name: "Aporagender", colors: ["#333333", "#D2218E", "#F8B7D3", "#FFFFFF", "#9BD5E3", "#0095B6"] },
            { name: "Cassgender", colors: ["#999999", "#C4C4C4", "#DCDCDC", "#FBFF8E", "#DCDCDC", "#C4C4C4", "#999999"] },
            { name: "Achillean", colors: ["#9AD9EB", "#FFFFFF", "#9AD9EB"] },
            { name: "Sapphic", colors: ["#FFAFC8", "#FFFFFF", "#FFAFC8"] },
            { name: "Diamoric", colors: ["#A7D379", "#FFFFFF", "#B57EDC"] },
            { name: "Neptunic", colors: ["#00AEEF", "#82CAFA", "#FFFFFF", "#FFB6C1", "#F5A9B8"] },
            { name: "Uranic", colors: ["#FF8ABD", "#FFAFC8", "#FFFFFF", "#82CAFA", "#00AEEF"] },
            { name: "Finsexual", colors: ["#FF8ABD", "#FFB6C1", "#FFD1DC", "#FFFFFF", "#B079D1"] },
            { name: "Minsexual", colors: ["#5BCEFA", "#9AD9EB", "#C2E5F2", "#FFFFFF", "#7BADE2"] },
            { name: "Ninsexual", colors: ["#B57EDC", "#D2B4DE", "#E6E6FA", "#FFFFFF", "#999999"] },
            { name: "Autosexual", colors: ["#5BCEFA", "#FFFFFF", "#9C59D1", "#000000"] },
            { name: "Polyamory", colors: ["#0000FF", "#FF0000", "#000000"] },
            { name: "Bear Brotherhood", colors: ["#623401", "#D36402", "#FFDD62", "#FEFDCB", "#FFFFFF", "#545454", "#000000"] },
            { name: "Leather Pride", colors: ["#000000", "#24408E", "#000000", "#24408E", "#E40303", "#24408E", "#000000", "#24408E", "#000000"] },
            { name: "Twink Pride", colors: ["#FFCCEE", "#FFFFFF", "#FFCCEE", "#FFCCEE", "#FFFF00", "#FFCCEE"] },
            { name: "Otter Pride", colors: ["#623401", "#D36402", "#FFDD62", "#FEFDCB", "#FFFFFF"] },
            { name: "Neuroqueer", colors: ["#000000", "#7F00FF", "#FF00FF", "#FF0000", "#FF7F00", "#FFFF00"] },
            { name: "Gendervoid", colors: ["#111111", "#222222", "#333333", "#444444"] },
            { name: "Mascuric", colors: ["#0000FF", "#87CEEB", "#FFFFFF"] },
            { name: "Feminic", colors: ["#FF00FF", "#FFB6C1", "#FFFFFF"] },
            { name: "Libragender", colors: ["#7F7F7F", "#C4C4C4", "#FFFFFF", "#C4C4C4", "#7F7F7F"] },
            { name: "Librasculine", colors: ["#7F7F7F", "#C4C4C4", "#5BCEFA", "#FFFFFF", "#5BCEFA", "#C4C4C4", "#7F7F7F"] },
            { name: "Librafeminine", colors: ["#7F7F7F", "#C4C4C4", "#F5A9B8", "#FFFFFF", "#F5A9B8", "#C4C4C4", "#7F7F7F"] }
        ];

        let currentTarget = null;
        let revealedIndices = [];
        let guesses = 0;

        function createGradient(colors) {
            const step = 100 / colors.length;
            let gradientStr = 'linear-gradient(180deg, ';
            colors.forEach((color, i) => {
                const start = i * step;
                const end = (i + 1) * step;
                gradientStr += `${color} ${start}%, ${color} ${end}%${i === colors.length - 1 ? '' : ', '}`;
            });
            gradientStr += ')';
            return gradientStr;
        }

        function initGame() {
            guesses = 0;
            revealedIndices = [];
            document.getElementById('history-list').innerHTML = '';
            document.getElementById('message').innerText = '';
            document.getElementById('guess-input').value = '';
            document.getElementById('game-controls').classList.remove('hidden');
            document.getElementById('success-controls').classList.add('hidden');
            document.getElementById('failure-controls').classList.add('hidden');

            currentTarget = flags[Math.floor(Math.random() * flags.length)];
            
            const display = document.getElementById('flag-display');
            display.style.background = createGradient(currentTarget.colors);

            const mask = document.getElementById('mask');
            mask.innerHTML = '';
            currentTarget.colors.forEach((_, i) => {
                const seg = document.createElement('div');
                seg.className = 'mask-segment';
                seg.id = `mask-${i}`;
                mask.appendChild(seg);
            });

            revealRandomStripe();
        }

        function revealRandomStripe() {
            const total = currentTarget.colors.length;
            if (revealedIndices.length >= total) return false;

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * total);
            } while (revealedIndices.includes(randomIndex));

            revealedIndices.push(randomIndex);
            document.getElementById(`mask-${randomIndex}`).classList.add('revealed');
            return true;
        }

        function submitGuess() {
            const input = document.getElementById('guess-input');
            const guess = input.value.trim();
            if (!guess) return;

            guesses++;
            const isCorrect = checkMatch(guess, currentTarget.name);

            const historyList = document.getElementById('history-list');
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                <span>${guess}</span>
                <span class="${isCorrect ? 'text-green-500' : 'text-red-500'} font-bold">
                    ${isCorrect ? '✓' : '✗'}
                </span>
            `;
            historyList.prepend(item);

            if (isCorrect) {
                document.getElementById('game-controls').classList.add('hidden');
                document.getElementById('success-controls').classList.remove('hidden');
                document.getElementById('win-text').innerText = `That's the ${currentTarget.name} flag!`;
                // Reveal all
                currentTarget.colors.forEach((_, i) => {
                    document.getElementById(`mask-${i}`).classList.add('revealed');
                });
            } else {
                const moreStripes = revealRandomStripe();
                if (!moreStripes) {
                    // Out of reveals (Failure state)
                    document.getElementById('game-controls').classList.add('hidden');
                    document.getElementById('failure-controls').classList.remove('hidden');
                    document.getElementById('fail-text').innerText = `It was the ${currentTarget.name} flag.`;
                } else {
                    document.getElementById('message').innerText = "Not quite! Another stripe revealed.";
                    document.getElementById('message').classList.add('text-red-400');
                    input.value = '';
                }
            }
        }

        function checkMatch(guess, targetName) {
            const g = guess.toLowerCase().trim();
            const t = targetName.toLowerCase();
            
            // If target is "A / B", check if guess is A or B or A/B
            if (t.includes('/')) {
                const components = t.split('/').map(c => c.trim().toLowerCase());
                return components.includes(g) || t === g;
            }
            
            return g === t;
        }

        // Initialize Search Suggestions
        const datalist = document.getElementById('flag-list');
        const allSuggestions = new Set();
        flags.forEach(f => {
            if (f.name.includes('/')) {
                f.name.split('/').forEach(p => allSuggestions.add(p.trim()));
            }
            allSuggestions.add(f.name);
        });

        Array.from(allSuggestions).sort().forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            datalist.appendChild(opt);
        });

        window.onload = initGame;
        document.getElementById('guess-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitGuess();
        });
    </script>
</body>
</html>
